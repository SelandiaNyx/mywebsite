<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arch Linux 安装指南</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        header {
            background: #007bff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
        }
        section {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #007bff;
        }
        pre {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        ol, ul {
            margin: 10px 0 20px 20px;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>Arch Linux 安装指南</h1>
        <p>发布日期: 2024年9月28日</p>
    </header>
    <section>
        <h2>1. 连接无线网络</h2>
    <pre><code>iwctl
device list
station wlan0 scan
station wlan0 get-networks
station wlan0 connect YOUR-WIRELESS-NAME
exit
ping www.baidu.com</code></pre>
    </section>
    <section>
    <h2>2. 更新系统时钟</h2>
    <pre><code>timedatectl set-ntp true
timedatectl status</code></pre>
    </section>
    <section>
    <h2>3. 分区</h2>
    <p><span class="comment">首先将磁盘转换为 GPT 类型：</span></p>
    <pre><code>lsblk
parted /dev/nvme0n1
mktable
New disk label type? gpt
quit</code></pre>
    <p><span class="comment">然后使用 <code>cfdisk</code> 分区：</span></p>
    <pre><code>cfdisk /dev/nvme0n1
fdisk -l</code></pre>
    <p><span class="comment">EFI,SWAP,/ 三个分区，类型选择 EFI,Linux swap 和默认，write 写入并退出</span></p>
    </section>
    <section>
    <h2>4. 格式化</h2>
    <pre><code>mkfs.fat -F 32 /dev/nvme0n1p1
mkswap /dev/nvme0n1p2
mkfs.btrfs /dev/nvme0n1p3</code></pre>
    </section>
    <section>
    <h2>5. 挂载</h2>
    <p><span class="comment">挂载分区并创建子卷：</span></p>
    <pre><code>mount -t btrfs -o compress=zstd /dev/nvme0n1p3 /mnt
btrfs subvolume create /mnt/@
btrfs subvolume create /mnt/@home
umount /mnt</code></pre>
    <p><span class="comment">正式挂载分区：</span></p>
    <pre><code>mount -t btrfs -o subvol=/@,compress=zstd /dev/nvme0n1p3 /mnt
mkdir /mnt/home
mount -t btrfs -o subvol=/@home,compress=zstd /dev/nvme0n1p3 /mnt/home
mkdir -p /mnt/boot
mount /dev/nvme0n1p1 /mnt/boot
swapon /dev/nvme0n1p2</code></pre>
    </section>
    <section>
    <h2>6. 安装系统</h2>
    <p><span class="comment">修改 <code>pacman</code> 配置文件：</span></p>
    <pre><code>vim /etc/pacman.conf</code></pre>
    <p><span class="comment">删除 <code>#ParallelDownloads = 5</code> 前面的 <code>#<code></span></p>
    <pre><code>vim /etc/pacman.d/mirrorlist</code></pre>
    <p><span class="comment">添加 <code>Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch</code></span></p>
    <p><span class="comment">接着使用 <code>pacstrap</code> 安装系统：</span></p>
    <pre><code>pacstrap /mnt base base-devel linux-zen linux-zen-headers linux-firmware btrfs-progs</code></pre>
    </section>
    <section>
    <h2>7. 安装其它必要软件</h2>
    <pre><code>pacstrap /mnt networkmanager vim sudo bash bash-completions</code></pre>
    </section>
    <section>
    <h2>8. 生成 fstab 文件</h2>
    <pre><code>genfstab -U /mnt >> /mnt/etc/fstab</code></pre>
    </section>
    <section>
    <h2>9. 切换 root</h2>
    <pre><code>arch-chroot /mnt</code></pre>
    </section>
    <section>
    <h2>10. 设置主机名与时区</h2>
    <pre><code>vim /etc/hostname
vim /etc/hosts</code></pre>
    <p><span class="comment">添加以下内容：</span></p>
    <pre><code>127.0.0.1   localhost
::1         localhost
127.0.1.1   主机名.localdomain 主机名</code></pre>
    <pre><code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></pre>
    </section>
    <section>
    <h2>11. 硬件时间同步</h2>
    <pre><code>hwclock --systohc</code></pre>
    </section>
    <section>
    <h2>12. 设置 Locale</h2>
    <pre><code>vim /etc/locale.gen</code></pre>
    <p><span class="comment">编辑 <code>/etc/locale.gen</code> 去掉 <code> en_US.UTF-8 UTF-8</code> 以及 <code>zh_CN.UTF-8 UTF-8 </code>行前的注释符号 <code>#</code></span></p>
    <pre><code>locale-gen
echo 'LANG=en_US.UTF-8' > /etc/locale.conf</code></pre>
    </section>
    <section>
    <h2>13. 设置 root 密码</h2>
    <pre><code>passwd root</code></pre>
    </section>
    <section>
    <h2>14. 安装微码</h2>
    <pre><code>pacman -S intel-ucode   # Intel CPU 微码
pacman -S amd-ucode     # AMD CPU 微码</code></pre>
    </section>
    <section>
    <h2>15. 安装引导程序</h2>
    <pre><code>pacman -S grub efibootmgr os-prober
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ARCH
vim /etc/default/grub</code></pre>
    <p><span class="comment">多系统把最后一行 <code>#GRUB_DISABLE_OS_PROBER=false</code> 取消注释 <code>NVIDIA</code> 显卡现在就可以修改 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 里的内容，加入 <code>nvidia-drm.modeset=1</code> 和  <code>nvidia.NVreg_PreserveVideoMemoryAllocations=1</code> 前一个开启  <code>drm</code> 后一个让系统可以正常休眠</span></p>
    <pre><code>grub-mkconfig -o /boot/grub/grub.cfg</code></pre>
    </section>
    <section>
    <h2>16. 完成安装</h2>
    <pre><code>exit
umount -R /mnt
reboot</code></pre>
    </section>
    <section>
    <h2>17. 开启网络服务</h2>
    <pre><code>systemctl enable --now NetworkManager</code></pre>
    </section>
    <section>
    <h2>18. 打印系统信息</h2>
    <pre><code>pacman -S fastfetch
fastfetch</code></pre>
    </section>
    <section>
    <h2>19. 设置 root 账户的默认编辑器</h2>
    <pre><code>vim ~/.bash_profile
export EDITOR='vim'</code></pre>
    </section>
    <section>
    <h2>20. 准备非 root 用户</h2>
    <pre><code>useradd -m -G wheel -s /bin/bash myusername
passwd myusername
EDITOR=vim visudo</code></pre>
    </section>
    <section>
    <h2>21. 开启 32 位支持库与 Arch Linux 中文社区仓库</h2>
    <pre><code>vim /etc/pacman.conf
去掉 [multilib] 一节中的注释
添加以下内容：
[archlinuxcn]
Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch</code></pre>
    </section>
    <section>
    <h2>22. 安装 KDE Plasma 桌面环境及相关软件</h2>
    <pre><code>pacman -S plasma-meta konsole dolphin firefox nvidia-open-dkms nvidia-utils lib32-nvidia-utils ntfs-3g adobe-source-han-serif-cn-fonts wqy-zenhei noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra unzip unrar packagekit packagekit-qt6 gwenview</code></pre>
    </section>
    <section>
    <h2>23. 配置并启动 SDDM</h2>
    <pre><code>systemctl enable sddm
reboot</code></pre>
    </section>
    <section>
    <h2>24. 配置非 root 用户的默认编辑器</h2>
    <pre><code>vim ~/.bashrc
export EDITOR='vim'</code></pre>
    </section>
    <section>
    <h2>25. 安装输入法</h2>
    <pre><code>sudo pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-pinyin-moegirl fcitx5-pinyin-sougou
mkdir ~/.config/environment.d
vim ~/.config/environment.d/im.conf
加入以下内容：
XMODIFIERS=@im=fcitx</code></pre>
    </section>
    <section>
    <h2>26. 开启蓝牙</h2>
    <pre><code>sudo systemctl enable --now bluetooth</code></pre>
    </section>
    <section>
    <h2>27. 设置全局代理</h2>
    <pre><code>sudo pacman -S daed
sudo systemctl enable --now daed
浏览器打开<a href="http://localhost:2023" target="_blank">http://localhost:2023</a>添加订阅并拖至代理后，打开右上角开关开始使用</code></pre>
    </section>
</body>
</html>
